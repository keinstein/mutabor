#       -*- Makefile-automake -*-
top_docdir = $(srcdir)/$(rel_docdir)
macdocdir = $(top_builddir)/Mutabor.app/Contents/Resources
override pkgdatadir:=$(pkgdatadir)/$(DOCLOCALE)
#pkgdatadir := $(localpkgdatadir)

.PHONY: mac copymac install-data-mutabor zipfile
%.pdf:%.tex $(TEXSOURCES) $(top_docdir)/preamble.tex \
	$(TEX_DEPS)
	rm $*.out $*.aux $*.ind; \
	for i in 0 1 2 ; \
	do \
		TEXINPUTS=".:$(srcdir):$(top_docdir):$$TEXINPUTS" \
		pdflatex --synctex=1 '$*' ; \
		makeindex `basename "$*"` ; \
		makeglossaries `basename "$*"` ; \
	done ; \
	mv `basename $*.pdf` $@

html: $(ZIPFILE)
$(ZIPFILE): $(TEXSOURCES) $(top_docdir)/mutabor.cfg \
	$(top_docdir)/preamble.tex \
	$(TEX_DEPS)
	TEXINPUTS=".:$(srcdir):$(top_docdir):$$TEXINPUTS" \
	htmldecode='$(rel_docdir)/htmldecode' \
	fixhhp='$(rel_docdir)/fixhhp' \
	srcdir='$(srcdir)' \
	top_docdir='$(top_docdir)' \
	$(top_docdir)/mkhtml $(TEXSOURCES) 
	cp help.zip $(srcdir)/$(ZIPFILE)

pdf-am: $(PDFFILES)


dist: $(srcdir)/$(ZIPFILE)

mac: $(srcdir)/$(ZIPFILE) copymac

copymac:
	mkdir -p $(macdocdir)
	if test -z "$(DOCLOCALE)" ; then \
		cp '$(srcdir)/$(ZIPFILE)' '$(macdocdir)' ; \
	else \
		mkdir -p $(macdocdir)/$(DOCLOCALE).lproj ; \
		cp '$(srcdir)/$(ZIPFILE)' '$(macdocdir)/$(DOCLOCALE).lproj' ; \
	fi

install-data-local: install-data-mutabor html
#	test -z '$(pkgdatadir)/$(DOCLOCALE)' || \
#		$(MKDIR_P) '$(pkgdatadir)/$(DOCLOCALE)'
#	$(INSTALL_DATA) '$(srcdir)/$(ZIPFILE)' '$(pkgdatadir)/$(DOCLOCALE)/'

install-data-mutabor:

